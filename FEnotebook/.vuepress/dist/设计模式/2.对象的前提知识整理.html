<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.对象定义方式与描述符关系 | myNotebook</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/FEnotebook/assets/css/0.styles.13c0ca14.css" as="style"><link rel="preload" href="/FEnotebook/assets/js/app.5a1ae3c7.js" as="script"><link rel="preload" href="/FEnotebook/assets/js/2.94fbeaa6.js" as="script"><link rel="preload" href="/FEnotebook/assets/js/11.c9751ed4.js" as="script"><link rel="prefetch" href="/FEnotebook/assets/js/10.1cb94038.js"><link rel="prefetch" href="/FEnotebook/assets/js/12.f87d9604.js"><link rel="prefetch" href="/FEnotebook/assets/js/13.fcfd7a1e.js"><link rel="prefetch" href="/FEnotebook/assets/js/14.99912993.js"><link rel="prefetch" href="/FEnotebook/assets/js/3.e8d65a1d.js"><link rel="prefetch" href="/FEnotebook/assets/js/4.fe5120f6.js"><link rel="prefetch" href="/FEnotebook/assets/js/5.56963043.js"><link rel="prefetch" href="/FEnotebook/assets/js/6.17e30057.js"><link rel="prefetch" href="/FEnotebook/assets/js/7.95ab6649.js"><link rel="prefetch" href="/FEnotebook/assets/js/8.15c2432f.js"><link rel="prefetch" href="/FEnotebook/assets/js/9.a9340ac3.js">
    <link rel="stylesheet" href="/FEnotebook/assets/css/0.styles.13c0ca14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FEnotebook/" class="home-link router-link-active"><!----> <span class="site-name">myNotebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/FEnotebook/设计模式/0.导语" class="sidebar-heading clickable open"><span>设计模式</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/FEnotebook/设计模式/0.导语.html" class="sidebar-link">0.导语</a></li><li><a href="/FEnotebook/设计模式/1.定义.html" class="sidebar-link">1.定义</a></li><li><a href="/FEnotebook/设计模式/2.对象的前提知识整理.html" class="active sidebar-link">2.对象定义方式与描述符关系</a></li><li><a href="/FEnotebook/设计模式/3.Constructor模式.html" class="sidebar-link">3.Constructor(构造器)模式</a></li><li><a href="/FEnotebook/设计模式/4.Module模式.html" class="sidebar-link">4.Module模式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="_2-对象定义方式与描述符关系"><a href="#_2-对象定义方式与描述符关系" class="header-anchor">#</a> 2.对象定义方式与描述符关系</h4> <p>​	读取属性的描述：Object.getOwnPropertyDescriptor()或getOwnPropertyDescriptor()</p> <p>​	设置属性的描述：Object.definePropertype或Object.defineProperties</p> <p>​	1）使用<strong>Object.definePropertype</strong>创建对象：省略的描述符默认值都是false,getter和setter都是undefined</p> <p>​	2）直接在对象中创建时（字面量描述方式），所有描述符默认值都是true</p> <h4 id="_2-对象属性描述符"><a href="#_2-对象属性描述符" class="header-anchor">#</a> 2.对象属性描述符</h4> <p>​	数据描述符：是一个有值的属性，可写，也可以不可写</p> <p>​	存取描述符：由getter，setter函数对描述的属性</p> <h5 id="数据描述符："><a href="#数据描述符：" class="header-anchor">#</a> 数据描述符：</h5> <p>​		<strong>configurable</strong>-：是否可以删除某个属性或修改属性的描述，为true时可进行操作，如果该属性先定义为false,后续又定义为true的话会报错</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
       configurable<span class="token operator">:</span><span class="token boolean">false</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
     Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      configurable<span class="token operator">:</span><span class="token boolean">true</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>​		<strong>writable</strong>-属性是否可写</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  writable<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
person<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'小李'</span><span class="token punctuation">;</span> <span class="token comment">//属性不可写，严格模式下会报错console.log(person.name); //输出小王，说明上面一句无效`</span>
</code></pre></div><p>​		<strong>enumerable</strong>-属性是否可被枚举，<strong>默认为false</strong>,该属性主要是用来防范Object.keys（）和for in的，也就是说该属性设置对于Object.getOwnPropertyNames()方法是无效的。</p> <p>​			枚举属性输出的数组元素顺序：</p> <p>​				在es5中并没有明确这一点，各个浏览器有自己的实现，es6中采用Object.keys（）和for in方法时还是没有明确；</p> <p>​				采用Object.getOwnPropertyNames()方法枚举时，有了相应的标准：</p> <p>最先放入数组中的是数值型的成员名，按升序排列；其次是其它类型的，按添加的先后顺序排列</p> <p>​		**<code>value``-</code>**该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined</p> <h5 id="存取描述符："><a href="#存取描述符：" class="header-anchor">#</a> 存取描述符：</h5> <p>​			<strong>get与set</strong>-读写成员时调用的函数，默认为undefined，如果只有get则表示属性值是只读的，只有set表示只能写。属性读写器最常用的场景就是在读取或写入属性前可以附带的做一些操作，达到更好的封装性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'pri'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
       <span class="token function-variable function">get</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token comment">//做一些其它操作</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'准备获取_pri的值'</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span> _pri<span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token function-variable function">set</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         _pri <span class="token operator">=</span>newValue
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
     person<span class="token punctuation">.</span>pri<span class="token operator">=</span><span class="token string">'456'</span><span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>pri<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="某些描述符是相互排斥的，相应的关系见下表："><a href="#某些描述符是相互排斥的，相应的关系见下表：" class="header-anchor">#</a> 某些描述符是相互排斥的，相应的关系见下表：</h5> <p>​		<img src="https://img2018.cnblogs.com/blog/1155527/201908/1155527-20190810120358835-1368073487.png" alt="img"></p> <h4 id="_3-对象保护"><a href="#_3-对象保护" class="header-anchor">#</a> 3.对象保护</h4> <p>​	1）阻止在对象添加成员</p> <p>​			**Object.preventExtensions()**该方法用于阻止向对象添加成员,</p> <p>​			使用Object.isExtensible()判断对象是否可添加成员</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加成员无效，非严格模式下什么都不会发生，严格模式下会报错</span>
    person<span class="token punctuation">.</span>bankAccount<span class="token operator">=</span><span class="token string">'中国农业银行'</span>
    <span class="token comment">//依然可以删除成员，证明了preventExtensions方法只能阻止添加方法</span>
    <span class="token keyword">delete</span> person<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">//undefined，表明删除成功了</span>
</code></pre></div><p>​		2）阻止添加/删除成员</p> <p>​			**Object.seal()**用来阻止添加或删除成员，</p> <p>​			判断对象是否是密封的，可采用Object.isSealed()</p> <p>​		3）阻止添加，删除，赋值修改：</p> <p>​			**Object.freeze()**会阻止添加，删除，赋值修改，但仍然可以写入</p> <p><img src="/Users/alisa/mac/Documents/learn/FEnotebook/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/image-20200515103234996.png" alt="image-20200515103234996"></p> <h4 id="_4-其他技巧："><a href="#_4-其他技巧：" class="header-anchor">#</a> 4.其他技巧：</h4> <p>​	1）实现继承：</p> <p>​	Object.create(person)可产生一个具有继承特性的新对象，但父对象与子对象共享引用类型成员，即修改子对象引用类型成员时，父对象该成员也被同步变化</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> father <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'小王'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    act<span class="token operator">:</span> <span class="token string">'father'</span><span class="token punctuation">,</span>
  	friends<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'小红'</span><span class="token punctuation">,</span> <span class="token string">'小李'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> child <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>father<span class="token punctuation">)</span>
child<span class="token punctuation">.</span>_proto_<span class="token punctuation">.</span>act <span class="token operator">=</span> <span class="token string">'son'</span> <span class="token comment">// father的act也变成了son</span>
child<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// father的friends也减少了一个</span>
</code></pre></div><p>​	es6中的Object.setPrototypeOf(obj, prototype)方法可将已有的对象变成继承关系，其内部原理和Object.create一样，都是将子对象的prototype指向父对象，该方法实现的继承依然有抚子对象共享了引用类型成员的问题</p> <p>​</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  	<span class="token keyword">var</span> person<span class="token operator">=</span><span class="token punctuation">{</span>
       age<span class="token operator">:</span><span class="token number">15</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> man<span class="token operator">=</span><span class="token punctuation">{</span>
        
     <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>man<span class="token punctuation">,</span>person<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>man<span class="token punctuation">)</span><span class="token operator">===</span>person<span class="token punctuation">)</span> <span class="token comment">//true</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>man<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//15</span>
</code></pre></div><p>​	2）继承对象的属性赋值问题</p> <p>​		<strong>若父对象属性设置为不可写，向子对象该属性赋值，严格模式下报错，非严格模式下不生效</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> parent<span class="token operator">=</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'parent'</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  writable<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> child<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
child<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'child'</span> <span class="token comment">//严格模式下报错，非严格模式下默认失败</span>
</code></pre></div><p>​		<strong>若父对象的属性设置了set描述符，赋值这个继承的子对象对应属性时会触发set,如果未定义get，则无法获取属性值</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'use strict'</span>
<span class="token keyword">var</span> parent<span class="token operator">=</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span><span class="token string">'parent'</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'父元素的set被调用了'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> child<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
child<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'child'</span> <span class="token comment">//会触发父对象中的set</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">//undefined,只有父对象的name属性描述符设置了get才能获取到值</span>
</code></pre></div><p>​	3）重写父对象成员</p> <p>​		直接在子对象定义一个同名成员</p> <p>​	4）实现在子对象中访问父对象成员</p> <p>​		es6新增：super关键字，是一个指向当前对象原型的指针，即父对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> father <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'小王'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    act<span class="token operator">:</span> <span class="token string">'father'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">say</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是父亲'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是儿子，我父亲说：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> father<span class="token punctuation">)</span>
child<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 我是儿子，我父亲说： 我是父亲</span>
</code></pre></div><p>​	如果不是继承关系，使用super会报错</p> <p>​	5）一句话实现jquery.extend</p> <p>​		jquery.extend是一个典型的对象混入</p> <p>​		*对象混入：*将n个对象组合成一个新的对象，新对象具有各个输入对象的所有特征，在设计模式里也叫<strong>装饰器模式</strong></p> <p>​		示例：一个简易版的jq.extend的浅拷贝模式</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		<span class="token keyword">function</span> <span class="token function">mixins</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>sourceArr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       sourceArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            target<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> target
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> obj1<span class="token operator">=</span><span class="token punctuation">{</span>
       name<span class="token operator">:</span><span class="token string">'123'</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> obj2<span class="token operator">=</span><span class="token punctuation">{</span>
       id<span class="token operator">:</span><span class="token number">100</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> obj3<span class="token operator">=</span><span class="token punctuation">{</span>
       <span class="token function">meth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'haha'</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">var</span> target<span class="token operator">=</span><span class="token function">mixins</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span><span class="token punctuation">[</span>obj2<span class="token punctuation">,</span>obj3<span class="token punctuation">]</span><span class="token punctuation">)</span>
     target<span class="token punctuation">.</span><span class="token function">meth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	
</code></pre></div><p>​		<strong>es6中可使用Object.assign(obj1, obj2, obj3)实现混入。</strong></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FEnotebook/设计模式/1.定义.html" class="prev">
        1.定义
      </a></span> <span class="next"><a href="/FEnotebook/设计模式/3.Constructor模式.html">
        3.Constructor(构造器)模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FEnotebook/assets/js/app.5a1ae3c7.js" defer></script><script src="/FEnotebook/assets/js/2.94fbeaa6.js" defer></script><script src="/FEnotebook/assets/js/11.c9751ed4.js" defer></script>
  </body>
</html>
